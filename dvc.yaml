params:
- params.yaml
- dvclive/params.yaml
stages:
  label_data_extract:
    cmd: python pipelines/extract_data_to_label.py 
      "inputs/label_data/${label_data_extract.basename}.tsv" 
      ${label_data_extract.freq} 
      "inputs/labeled_data/${label_data_extract.pre_labels}.csv" 
      "outputs/label_data/${label_data_extract.basename}.csv" 
      "outputs/${label_data_extract.counts_outname}.csv"
    deps:
    - pipelines/extract_data_to_label.py
    - inputs/label_data/${label_data_extract.basename}.tsv
    - inputs/labeled_data/${label_data_extract.pre_labels}.csv
    - wikilacra/stream.py
    outs:
    - outputs/label_data/${label_data_extract.basename}.csv
    - outputs/${label_data_extract.counts_outname}.csv
  features:
    cmd: python pipelines/engineer-features.py ${features.rolling_avg_hrs} 
      ${features.intra_pd} ${features.intra_win} 
      "inputs/label_data/${features.dump_basename}.tsv" 
      "inputs/labeled_data/${features.labeled_basename}.csv" 
      "outputs/labeled_engineered/" "${features.basename}" 
      "${features.start_dt}" "${features.end_dt}"
    deps:
    - inputs/label_data/${features.dump_basename}.tsv
    - pipelines/engineer-features.py
    - wikilacra/__init__.py
    - wikilacra/features.py
    - wikilacra/stream.py
    - inputs/labeled_data/${features.labeled_basename}.csv
    outs:
    - outputs/labeled_engineered/${features.basename}.csv
    - outputs/labeled_engineered/${features.basename}_exog_cols.txt
    - outputs/labeled_engineered/${features.basename}_endog_cols.txt
  train-RF:
    cmd: python pipelines/RF.py "outputs/labeled_engineered/" 
      "${train-RF.input_name}" ${train-RF.metric_name} ${train-RF.random_state} 
      ${train-RF.n_jobs} ${train-RF.max_depths_gen} "${train-RF.max_depths}" 
      ${train-RF.n_estimators_gen} "${train-RF.n_estimators}" 
      ${train-RF.test_prop} ${train-RF.CV_type} ${train-RF.N_fold_cv}
    deps:
    - pipelines/RF.py
    - outputs/labeled_engineered/${train-RF.input_name}.csv
    - wikilacra/scoring.py
    - wikilacra/data.py
    outs:
    - dvclive/
  train-XGBT:
    cmd: python pipelines/XGBT.py "outputs/labeled_engineered/" 
      "${train-XGBT.input_name}" ${train-XGBT.metric_name} ${train-XGBT.random_state} 
      ${train-XGBT.n_jobs} ${train-XGBT.max_depths_gen} "${train-XGBT.max_depths}" 
      ${train-XGBT.test_prop} ${train-XGBT.CV_type} ${train-XGBT.N_fold_cv}
    deps:
    - pipelines/XGBT.py
    - outputs/labeled_engineered/${train-RF.input_name}.csv
    - wikilacra/scoring.py
    - wikilacra/data.py
    outs:
    - dvclive/
plots:
- dvclive/plots/metrics:
    x: step
- dvclive/plots/images
metrics:
- dvclive/metrics.json
